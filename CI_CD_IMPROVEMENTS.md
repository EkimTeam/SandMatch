# –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è CI/CD –¥–ª—è SandMatch

## –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2025-10-21
## –°—Ç–∞—Ç—É—Å: –í —Ä–∞–±–æ—Ç–µ

---

## üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

### ‚úÖ 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—É—Ç–µ–π –¥–ª—è –∞—Å—Å–µ—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** Vite –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—É—Ç–∏ `/assets/...`, –Ω–æ Django —Ä–∞–∑–¥–∞—ë—Ç –∏–∑ `/static/frontend/`  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** 404 –Ω–∞ –≤—Å–µ JS/CSS —Ñ–∞–π–ª—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ  
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å `base` –∏–∑ vite.config.ts, –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å `/static/frontend/` –≤ template tags  
**–§–∞–π–ª—ã:** 
- `frontend/vite.config.ts` (—É–±—Ä–∞–Ω base path)
- `apps/core/templatetags/vite_assets.py` (–¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å –≤ vite_asset –∏ vite_css_assets)
- `sandmatch/urls.py` (—É–±—Ä–∞–Ω —Å—Ç–∞—Ä—ã–π –∏–º–ø–æ—Ä—Ç get_vite_assets)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

### ‚úÖ 2. –°–æ–∑–¥–∞—Ç—å Django integration –¥–ª—è Vite manifest
**–ü—Ä–æ–±–ª–µ–º–∞:** –®–∞–±–ª–æ–Ω spa.html –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `vite_assets`, –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è manifest.json  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** Django –Ω–µ –∑–Ω–∞–µ—Ç –∫–∞–∫–∏–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å template tag –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ manifest.json  
**–§–∞–π–ª—ã:** 
- `apps/core/templatetags/vite_assets.py` (—Å–æ–∑–¥–∞–Ω–æ)
- `apps/core/__init__.py` (—Å–æ–∑–¥–∞–Ω–æ)
- `apps/core/apps.py` (—Å–æ–∑–¥–∞–Ω–æ)
- `templates/spa.html` (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
- `templates/vite_assets_tags.html` (—Å–æ–∑–¥–∞–Ω–æ)
- `sandmatch/settings/base.py` (–¥–æ–±–∞–≤–ª–µ–Ω–æ apps.core –≤ INSTALLED_APPS)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

### ‚úÖ 3. –î–æ–±–∞–≤–∏—Ç—å Nginx reverse proxy
**–ü—Ä–æ–±–ª–µ–º–∞:** Gunicorn —Ä–∞–∑–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏–∫—É –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –Ω–µ—Ç gzip, –Ω–µ—Ç HTTP/2, —Ç—Ä–∞—Ç—ã worker'–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å Nginx –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏–∫–∏ –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∫ Gunicorn  
**–§–∞–π–ª—ã:**
- `nginx/nginx.conf` (—Å–æ–∑–¥–∞–Ω —Å gzip, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π)
- `docker-compose.prod.yml` (–¥–æ–±–∞–≤–ª–µ–Ω nginx service —Å healthcheck)
- `Dockerfile.nginx` (—Å–æ–∑–¥–∞–Ω)
- `deploy/deploy.sh` (–æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è —Å–±–æ—Ä–∫–∏ nginx)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

### ‚úÖ 4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å static files mapping
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É static/, staticfiles/ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∞—Å—Å–µ—Ç–æ–≤  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** Django –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–π—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∞—Å—Å–µ—Ç—ã  
**–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å: –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ staticfiles/frontend/, —É–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ  
**–§–∞–π–ª—ã:**
- `scripts/entrypoint.sh` (–∏–∑–º–µ–Ω—ë–Ω ASSETS_DST –Ω–∞ /app/staticfiles/frontend)
- `docker-compose.prod.yml` (–æ–±–Ω–æ–≤–ª—ë–Ω volume mount –Ω–∞ ./staticfiles)
- `deploy/deploy.sh` (–æ–±–Ω–æ–≤–ª—ë–Ω –ø—É—Ç—å –æ—á–∏—Å—Ç–∫–∏ –∞—Å—Å–µ—Ç–æ–≤)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)

### ‚úÖ 5. –î–æ–±–∞–≤–∏—Ç—å type checking –≤ CI
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ TypeScript —Ç–∏–ø–æ–≤ –≤ CI  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `tsc --noEmit` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤  
**–§–∞–π–ª—ã:** `.github/workflows/ci.yml`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–û—Å—Ç–∞–ª–æ—Å—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Vitest –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

### ‚úÖ 6. –í–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ node_modules
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π CI –ø—Ä–æ–≥–æ–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 200MB –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (2-3 –º–∏–Ω)  
**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å `cache: 'npm'` –≤ setup-node action  
**–§–∞–π–ª—ã:** 
- `.github/workflows/ci.yml` (–¥–æ–±–∞–≤–ª–µ–Ω cache: 'npm')
- `.nvmrc` (—Å–æ–∑–¥–∞–Ω –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–∏ Node.js)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

### ‚úÖ 7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å rollback –º–µ—Ö–∞–Ω–∏–∑–º
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –¥–µ–ø–ª–æ—è –Ω–µ—Ç –∞–≤—Ç–æ–æ—Ç–∫–∞—Ç–∞  
**–†–µ—à–µ–Ω–∏–µ:** 
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ–≥–∞ –≤ `.previous_image_tag` –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- –ê–≤—Ç–æ–æ—Ç–∫–∞—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ health check
- –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç –∫–æ–º–∞–Ω–¥–æ–π `./deploy.sh rollback`  
**–§–∞–π–ª—ã:** `deploy/deploy.sh`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ health check
# –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç
./deploy.sh rollback
```

---

### ‚úÖ 8. –£–ª—É—á—à–∏—Ç—å health check
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞  
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–ª—É—á—à–µ–Ω health endpoint —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î –∏ frontend –∞—Å—Å–µ—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω readiness probe –≤ docker-compose.prod.yml
- –ü—Ä–æ–≤–µ—Ä–∫–∞ manifest.json –≤ deploy.sh  
**–§–∞–π–ª—ã:** 
- `sandmatch/urls.py` (—É–ª—É—á—à–µ–Ω health endpoint)
- `docker-compose.prod.yml` (healthcheck –ø—Ä–æ–≤–µ—Ä—è–µ—Ç manifest.json)
- `deploy/deploy.sh` (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—Å—Å–µ—Ç–æ–≤)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**Health check —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- Django —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞
- Frontend –∞—Å—Å–µ—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ

---

## üìä –ñ–ï–õ–ê–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞)

### ‚è≥ 9. Bundle size monitoring
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å bundlesize –∏–ª–∏ size-limit –≤ CI  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### ‚è≥ 10. Lighthouse CI –¥–ª—è performance
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å @lhci/cli –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### ‚è≥ 11. Dependency scanning
**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å Dependabot –∏–ª–∏ Renovate –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### ‚è≥ 12. Staging environment
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–º  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–•–û–î–ö–ò

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: Lint –≤ CI –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–±–æ—Ä–∫—É
```yaml
- name: Frontend lint (non-blocking)
  continue-on-error: true  # ‚ùå –ü–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
```
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å `continue-on-error` –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö lint –æ—à–∏–±–æ–∫

---

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: Django check –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç CI
```yaml
python manage.py check --deploy --fail-level WARNING || true  # ‚ùå || true –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏
```
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å `|| true` –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

---

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç .nvmrc
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `.nvmrc` —Å –≤–µ—Ä—Å–∏–µ–π Node.js –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É dev/CI/prod  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: package-lock.json –≤ .gitignore
```gitignore
frontend/package-lock.json  # ‚ùå –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!
```
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å –∏–∑ .gitignore –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–±–æ—Ä–æ–∫

---

## üéØ –ü–û–†–Ø–î–û–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —ç—Ç–æ—Ç –ø–ª–∞–Ω
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—É—Ç–µ–π –¥–ª—è –∞—Å—Å–µ—Ç–æ–≤
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å Django template tag –¥–ª—è manifest
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å static files mapping
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å Nginx
6. ‚úÖ –í–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ npm –≤ CI
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å type checking –≤ CI
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å .nvmrc
9. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ë–î –≤ docker-compose.yml
10. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å urls.py (—É–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—ã–π vite.py)
11. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å rollback –º–µ—Ö–∞–Ω–∏–∑–º
12. ‚úÖ –£–ª—É—á—à–∏—Ç—å health check
13. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
14. ‚è≥ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (bundle size, Lighthouse, Dependabot)

---

## üìå –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ README.md
- –û–±–Ω–æ–≤–ª—è—Ç—å DEPLOYMENT_PLAN.md –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
