# Карта обработки персональных данных в SandMatch

## 1. Категории субъектов персональных данных

1. **Зарегистрированные пользователи (Web)**
   - Лица, создавшие учётную запись на сайте SandMatch.
2. **Игроки без веб-аккаунта**
   - Игроки, созданные организаторами для участия в турнирах, без собственной учётной записи.
3. **Организаторы турниров / Судьи**
   - Пользователи с особыми ролями (ORGANIZER, REFEREE, ADMIN и др.).
4. **Пользователи Telegram Mini App**
   - Участники, использующие мини-приложение Telegram, связанные с игроками/аккаунтами.
5. **Посетители сайта (анонимные)**
   - Лица, просматривающие публичные страницы без регистрации.

---

## 2. Состав и источники персональных данных

### 2.1. Зарегистрированные пользователи (Web)

**Основные модели / таблицы:**
- `auth_user`
- `accounts_userprofile`

**Типы данных:**
- Идентификационные:
  - Логин (`username`)
  - Имя, фамилия (`first_name`, `last_name`)
- Контактные:
  - Email (`email`)
- Профиль / роли:
  - Роль пользователя (`UserProfile.role`)
  - Связаный игрок (`UserProfile.player_id`)
  - Telegram ID / username (если связаны)
- Технические:
  - Дата создания, обновления профиля (`created_at`, `updated_at`)
- Согласие на ПДн:
  - `UserProfile.pdn_consent_given_at`
  - `UserProfile.pdn_consent_version`

**Источники данных:**
- Прямой ввод пользователем при регистрации и редактировании профиля.
- Связывание с игроком и Telegram через UI / API.

---

### 2.2. Игроки без веб-аккаунта

**Основные модели / таблицы:**
- `players_player`

**Типы данных:**
- Идентификационные:
  - Фамилия, имя
  - Отображаемое имя / псевдоним (если используется)
- Спортивная информация:
  - Уровень, рейтинг, статистика
  - Связь с рейтингом BTR (если есть)
- Связи:
  - `created_by` — пользователь, создавший игрока

**Источники данных:**
- Ввод организатором/пользователем при создании игрока через UI (в т.ч. модальные окна регистрации в турнир).
- Импорт/синхронизация с BTR (для привязанных игроков).

---

### 2.3. Организаторы турниров / Судьи

**Основные модели / таблицы:**
- `auth_user`
- `accounts_userprofile`
- `tournaments_tournament` (поля организатора и судей, если есть)

**Типы данных:**
- То же, что и для зарегистрированных пользователей, плюс:
  - Роль ORGANIZER / REFEREE / ADMIN
  - Связь с турнирами, которые пользователь создал или обслуживает

**Источники данных:**
- Назначение ролей через админку или соответствующие UI/эндпоинты.

---

### 2.4. Пользователи Telegram Mini App

**Основные модели / таблицы:**
- `accounts_userprofile` (Telegram ID, username)
- `telegram_*` (если есть отдельные таблицы для мини-приложения)
- `tournaments_tournamentregistration` (регистрации через Mini App)

**Типы данных:**
- Telegram ID, username
- Связь с игроком/аккаунтом
- Данные о регистрациях в турниры и статусах очереди

**Источники данных:**
- Авторизация и действия в Telegram Mini App.

---

### 2.5. Посетители сайта (анонимные)

**Основные источники / артефакты:**
- Web-серверные логи (Nginx / приложение)
- Cookies / технические идентификаторы сессии

**Типы данных:**
- IP-адрес, User-Agent, URL запросов
- Cookies для сессии / предпочтений

**Источники данных:**
- Автоматически при обращении к сайту.

---

## 3. Цели обработки по категориям данных

| Категория субъекта                | Основные цели обработки                                                                                  |
|----------------------------------|----------------------------------------------------------------------------------------------------------|
| Зарегистрированные пользователи  | Создание учётной записи, аутентификация, участие в турнирах, доступ к личному кабинету, уведомления.   |
| Игроки без веб-аккаунта         | Участие в турнирах, отображение в таблицах/сетках, ведение статистики, привязка к BTR.                  |
| Организаторы / Судьи            | Организация и администрирование турниров, управление участниками и результатами.                        |
| Пользователи Telegram Mini App  | Упрощённая регистрация и управление участием в турнирах через Telegram.                                 |
| Посетители (анонимные)          | Отображение публичной информации (турниры, рейтинги), базовая аналитика и защита от злоупотреблений.    |

---

## 4. Места хранения и доступ

### 4.1. База данных

- **СУБД:** PostgreSQL
- **Размещение:** Сервер(а) на территории РФ
- **Основные таблицы с ПДн:**
  - `auth_user`, `accounts_userprofile`
  - `players_player`
  - `tournaments_tournamententry`, `tournaments_tournamentregistration`
  - `btr_*` (косвенно, через привязку к игрокам)

**Доступ:**
- Через backend-приложение (Django), ограничен ролями и логикой вьюх/серилизаторов.
- Прямой доступ к БД — только у ограниченного круга администраторов/разработчиков.

---

### 4.2. Логи и бэкапы

- **Логи приложения / cron-задач:**
  - Могут содержать технические данные (IP, идентификаторы), сообщения об ошибках.
- **Бэкапы БД:**
  - Содержат копии всех таблиц, включая данные ПДн.

**Доступ:**
- Ограничен системными администраторами/DevOps.

---

### 4.3. Публичный интерфейс (UI)

- Публично доступные данные:
  - Названия турниров, даты, форматы.
  - ФИО игроков, результаты матчей, рейтинги.
- Непубличные данные (должны быть скрыты для анонимов):
  - Email, Telegram ID, внутренние идентификаторы аккаунта.

**Контроль:**
- Реализуется через:
  - UI (не показывать лишние поля);
  - API (сериализаторы и permissions);
  - ограничения в Django Admin.

---

## 5. Сроки хранения (базовые ориентиры)

> Точные сроки и политика уничтожения/обезличивания уточняются дополнительно и фиксируются в отдельном разделе политики.

- Учётные записи пользователей: на срок действия аккаунта + разумный период после удаления (для разрешения споров, журналирования).
- Данные о турнирах и результатах: длительное хранение в обезличенном/минимальном виде для статистики и истории соревнований.
- Логи: по внутренней политике (например, 1–12 месяцев), после чего — удаление или архивирование.
- Бэкапы: по политике резервного копирования (циклическое удаление устаревших копий).

---

## 6. Права доступа и ограничения (эскиз)

- **Анонимные пользователи:**
  - Читают только публичную информацию (турниры, таблицы, рейтинги, ФИО + результаты).
  - Не видят контактных данных (email, Telegram ID и т.п.).

- **Зарегистрированные пользователи:**
  - Доступ к своим данным (профиль, свои регистрации в турнирах).
  - Ограниченный доступ к информации об остальных игроках (ФИО, рейтинг, результаты), без контактов.

- **Организаторы / Судьи:**
  - Расширенный доступ к данным участников своих турниров (список участников, статусы, результаты).
  - Не должны видеть лишние контактные данные вне необходимости.

- **Администраторы:**
  - Полный доступ в пределах служебных обязанностей через админку/инструменты администрирования.

---

## 7. Использование карты обработки

Этот документ служит опорой для:

1. Проектирования функционала выгрузки данных пользователя (какие данные включать).
2. Определения сценариев анонимизации/удаления (что можно удалять, что переводить в обезличенный вид).
3. Проверки UI и API на предмет избыточного раскрытия ПДн.
4. Актуализации публичной политики обработки ПДн и внутренних регламентов.

По мере развития функционала SandMatch карту обработки следует актуализировать.
