# üìã –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –ú–ù–û–ì–û–°–¢–ê–î–ò–ô–ù–´–• –¢–£–†–ù–ò–†–û–í

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç–∞–¥–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è + —Ñ–∏–Ω–∞–ª—å–Ω–∞—è), –≥–¥–µ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –µ–¥–∏–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å "–¢—É—Ä–Ω–∏—Ä"
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∞–¥–∏–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏
- –†–µ–π—Ç–∏–Ω–≥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –≤—Å–µ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ —Ü–µ–ª–∏–∫–æ–º, –∞ –Ω–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
- –†–∞–∑–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (–∫—Ä—É–≥–æ–≤–∞—è, –æ–ª–∏–º–ø–∏–π—Å–∫–∞—è, –∫–∏–Ω–≥)

---

## üìê –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è
- **–ú–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä** - –∫–æ—Ä–Ω–µ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (`parent_tournament_id = NULL`)
- **–°—Ç–∞–¥–∏—è** - –¥–æ—á–µ—Ä–Ω–∏–π —Ç—É—Ä–Ω–∏—Ä (`parent_tournament_id != NULL`)

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞

#### 1. –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–æ–≤
- **–ú–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä**: –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–∫ —Å–æ–∑–¥–∞–ª –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü—Ä–æ–ê–º 22.11.25")
- **–°—Ç–∞–¥–∏–∏**: `{–Ω–∞–∑–≤–∞–Ω–∏–µ_–º–∞—Å—Ç–µ—Ä–∞} - {–Ω–∞–∑–≤–∞–Ω–∏–µ_—Å—Ç–∞–¥–∏–∏}` (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü—Ä–æ–ê–º 22.11.25 - –ü–ª–µ–π-–æ—Ñ—Ñ")

#### 2. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π
- ‚úÖ –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞–¥–∏—é –≤ —Å—Ç–∞—Ç—É—Å–µ **CREATED**
- ‚úÖ –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ–¥–Ω—é—é** —Å—Ç–∞–¥–∏—é (—Å —Ö–≤–æ—Å—Ç–∞)
- ‚ùå –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω—é—é –∏–ª–∏ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–µ —Å—Ç–∞–¥–∏–∏

#### 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ (—Ç–æ–ª—å–∫–æ CREATED)
- ‚úÖ **–ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å**: —Å–∏—Å—Ç–µ–º—É —Ç—É—Ä–Ω–∏—Ä–∞, —á–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —á–∏—Å–ª–æ –≥—Ä—É–ø–ø
- ‚ùå **–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å**: –¥–∞—Ç—É, —É—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞, –ø—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥ (–∫–æ–ø–∏—Ä—É—é—Ç—Å—è –æ—Ç –º–∞—Å—Ç–µ—Ä–∞)
- ‚ÑπÔ∏è **–û–ª–∏–º–ø–∏–π–∫–∞**: –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

#### 4. –ü–æ—Ä—è–¥–æ–∫ —Å—Ç–∞–¥–∏–π
- –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ –ø–æ–ª–µ `stage_order`
- ‚ùå –ú–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–ª—å–∑—è

#### 5. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞
- –ö–Ω–æ–ø–∫–∞ **"–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä"** - –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏ (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –≤—Å–µ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞)
- –ö–Ω–æ–ø–∫–∞ **"–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å—Ç–∞–¥–∏—é"** - –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏ (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±—É–¥–µ—Ç —É—Ç–æ—á–Ω–µ–Ω –ø–æ–∑–∂–µ)

#### 6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Å–∏—Å—Ç–µ–º–∞–º —Ç—É—Ä–Ω–∏—Ä–∞
- ‚ö†Ô∏è **KING** –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø–æ–¥—Å—Ç–∞–¥–∏–µ–π —Ç–æ–ª—å–∫–æ **KING**
- ‚úÖ **Round Robin** –∏ **Knockout** –º–æ–≥—É—Ç —Å–º–µ—à–∏–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π
- ‚ùå **KING** –ù–ï –º–æ–∂–µ—Ç —Å–º–µ—à–∏–≤–∞—Ç—å—Å—è —Å Round Robin –∏ Knockout

#### 7. –í–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç–∞–¥–∏–π
- **–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –∏ –∞–¥–º–∏–Ω**: –≤–∏–¥—è—Ç –≤—Å–µ —Å—Ç–∞–¥–∏–∏ (–≤–∫–ª—é—á–∞—è CREATED)
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞–¥–∏–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ ACTIVE –∏–ª–∏ COMPLETED

---

## üóÑÔ∏è –≠–¢–ê–ü 1: Backend - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏

### 1.1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

–î–æ–±–∞–≤–ª—è–µ–º –¥–≤–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `tournaments_tournament`:

```python
# apps/tournaments/migrations/XXXX_add_stage_fields.py

from django.db import migrations, models

class Migration(migrations.Migration):
    dependencies = [
        ('tournaments', 'XXXX_previous_migration'),
    ]

    operations = [
        migrations.AddField(
            model_name='tournament',
            name='stage_name',
            field=models.CharField(
                max_length=100, 
                blank=True, 
                default='',
                help_text="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏: '–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è', '–ü–ª–µ–π-–æ—Ñ—Ñ', etc."
            ),
        ),
        migrations.AddField(
            model_name='tournament',
            name='stage_order',
            field=models.IntegerField(
                default=0,
                help_text="–ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å—Ç–∞–¥–∏–∏ (0 –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞, 1, 2, 3... –¥–ª—è —Å—Ç–∞–¥–∏–π)"
            ),
        ),
    ]
```

### 1.2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Tournament

```python
# apps/tournaments/models.py

class Tournament(models.Model):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    
    parent_tournament = models.ForeignKey(
        'self',
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        related_name='child_stages',
        help_text="–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —Ç—É—Ä–Ω–∏—Ä (–º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä)"
    )
    
    stage_name = models.CharField(
        max_length=100,
        blank=True,
        default='',
        help_text="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏"
    )
    
    stage_order = models.IntegerField(
        default=0,
        help_text="–ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å—Ç–∞–¥–∏–∏ (0 –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞)"
    )
    
    # === –ú–ï–¢–û–î–´ –î–õ–Ø –†–ê–ë–û–¢–´ –°–û –°–¢–ê–î–ò–Ø–ú–ò ===
    
    def get_master_tournament(self):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π —Ç—É—Ä–Ω–∏—Ä (–º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä)"""
        if self.parent_tournament_id is None:
            return self
        return self.parent_tournament.get_master_tournament()
    
    def get_all_stages(self):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Å—Ç–∞–¥–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞ –≤ –ø–æ—Ä—è–¥–∫–µ stage_order"""
        master = self.get_master_tournament()
        stages = [master]
        stages.extend(
            master.child_stages.all().order_by('stage_order')
        )
        return stages
    
    def is_master(self):
        """–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–æ—Ä–Ω–µ–≤—ã–º —Ç—É—Ä–Ω–∏—Ä–æ–º"""
        return self.parent_tournament_id is None
    
    def get_stage_number(self):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–º–µ—Ä —Å—Ç–∞–¥–∏–∏ (1 –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞, 2, 3... –¥–ª—è —Å—Ç–∞–¥–∏–π)"""
        if self.is_master():
            return 1
        return self.stage_order + 1
    
    def can_delete_stage(self):
        """–ú–æ–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–∞–¥–∏—é"""
        # –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥
        if self.is_master():
            return False
        
        # –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ç—É—Å–µ CREATED
        if self.status != self.Status.CREATED:
            return False
        
        # –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç–∞–¥–∏—é
        master = self.get_master_tournament()
        all_stages = master.get_all_stages()
        last_stage = all_stages[-1] if all_stages else None
        
        return self.id == last_stage.id if last_stage else False
    
    def can_edit_stage_settings(self):
        """–ú–æ–∂–Ω–æ –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∞–¥–∏–∏"""
        # –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ç—É—Å–µ CREATED
        return self.status == self.Status.CREATED
    
    def validate_stage_system(self, new_system: str):
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞–¥–∏—é —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
        
        –ü—Ä–∞–≤–∏–ª–æ: KING –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø–æ–¥—Å—Ç–∞–¥–∏–µ–π —Ç–æ–ª—å–∫–æ KING
        Round Robin –∏ Knockout –º–æ–≥—É—Ç —Å–º–µ—à–∏–≤–∞—Ç—å—Å—è
        """
        master = self.get_master_tournament()
        
        # –ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä - KING, —Ç–æ –≤—Å–µ —Å—Ç–∞–¥–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å KING
        if master.system == 'king' and new_system != 'king':
            raise ValueError("–¢—É—Ä–Ω–∏—Ä —Å–∏—Å—Ç–µ–º—ã KING –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞–¥–∏–∏ —Å–∏—Å—Ç–µ–º—ã KING")
        
        # –ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä - –Ω–µ KING, —Ç–æ —Å—Ç–∞–¥–∏–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å KING
        if master.system != 'king' and new_system == 'king':
            raise ValueError("–¢—É—Ä–Ω–∏—Ä —Å–∏—Å—Ç–µ–º—ã Round Robin/Knockout –Ω–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å—Ç–∞–¥–∏–∏ —Å–∏—Å—Ç–µ–º—ã KING")
        
        return True
```

---

## üîß –≠–¢–ê–ü 2: Backend - –°–µ—Ä–≤–∏—Å—ã

### 2.1. –°–µ—Ä–≤–∏—Å MultiStageService

```python
# apps/tournaments/services/multi_stage_service.py

from django.db import transaction
from apps.tournaments.models import Tournament, TournamentEntry
from apps.players.models import PlayerRatingDynamic, PlayerRatingHistory

class MultiStageService:
    
    @staticmethod
    @transaction.atomic
    def create_next_stage(
        parent_tournament_id: int,
        stage_name: str,
        system: str,
        participant_mode: str,
        groups_count: int = 1,
        copy_participants: bool = True,
        selected_participant_ids: list[int] = None,
        created_by_user = None
    ):
        """
        –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Å—Ç–∞–¥–∏—é —Ç—É—Ä–Ω–∏—Ä–∞
        
        Args:
            parent_tournament_id: ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞ (–º–∞—Å—Ç–µ—Ä –∏–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç–∞–¥–∏—è)
            stage_name: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ (–∏–∑ –ø—Ä–µ—Å–µ—Ç–∞ –∏–ª–∏ —Å–≤–æ–µ)
            system: –°–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–Ω–∏—Ä–∞ ('round_robin', 'knockout', 'king')
            participant_mode: –†–µ–∂–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ('single', 'pair')
            groups_count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø (–¥–ª—è round_robin)
            copy_participants: –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            selected_participant_ids: –°–ø–∏—Å–æ–∫ ID –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏
            created_by_user: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Å–æ–∑–¥–∞—Ç–µ–ª—å
        
        Returns:
            Tournament: –°–æ–∑–¥–∞–Ω–Ω–∞—è —Å—Ç–∞–¥–∏—è
        
        Raises:
            ValueError: –ï—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞–¥–∏–π
        """
        parent = Tournament.objects.get(id=parent_tournament_id)
        master = parent.get_master_tournament()
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ç—É—Ä–Ω–∏—Ä–∞
        master.validate_stage_system(system)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –Ω–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏
        all_stages = master.get_all_stages()
        next_order = len(all_stages)  # 0 - –º–∞—Å—Ç–µ—Ä, 1, 2, 3... - —Å—Ç–∞–¥–∏–∏
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏
        full_name = f"{master.name} - {stage_name}"
        
        # –î–ª—è –æ–ª–∏–º–ø–∏–π–∫–∏ –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞
        if system == 'knockout':
            groups_count = 1
        
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç–∞–¥–∏—é
        new_stage = Tournament.objects.create(
            name=full_name,
            parent_tournament=master,
            stage_name=stage_name,
            stage_order=next_order,
            system=system,
            participant_mode=participant_mode,
            groups_count=groups_count,
            # –ö–æ–ø–∏—Ä—É–µ–º –æ—Ç –º–∞—Å—Ç–µ—Ä–∞ (–Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å)
            date=master.date,
            is_rating_calc=master.is_rating_calc,
            prize_fund=master.prize_fund,
            ruleset=master.ruleset,
            # –ü—Ä–æ—á–∏–µ –ø–æ–ª—è
            created_by=created_by_user or master.created_by,
            status=Tournament.Status.CREATED
        )
        
        # –ö–æ–ø–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        if copy_participants:
            # –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞–¥–∏–∏
            entries = TournamentEntry.objects.filter(tournament=parent)
            for entry in entries:
                TournamentEntry.objects.create(
                    tournament=new_stage,
                    team=entry.team,
                    is_out_of_competition=entry.is_out_of_competition
                )
        elif selected_participant_ids:
            # –¢–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏
            for team_id in selected_participant_ids:
                TournamentEntry.objects.create(
                    tournament=new_stage,
                    team_id=team_id,
                    is_out_of_competition=False
                )
        
        return new_stage
    
    @staticmethod
    def get_master_tournament_data(tournament_id: int):
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–∞ —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞–¥–∏—è–º–∏
        
        Returns:
            dict: {
                'master': {...},
                'stages': [...],
                'current_stage_id': int,
                'can_add_stage': bool
            }
        """
        tournament = Tournament.objects.get(id=tournament_id)
        master = tournament.get_master_tournament()
        stages = master.get_all_stages()
        
        return {
            'master': {
                'id': master.id,
                'name': master.name,
                'date': str(master.date) if master.date else '',
                'status': master.status,
                'system': master.system,
                'is_rating_calc': master.is_rating_calc,
                'prize_fund': master.prize_fund or '',
            },
            'stages': [
                {
                    'id': stage.id,
                    'stage_name': stage.stage_name or '–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞–¥–∏—è',
                    'stage_order': stage.get_stage_number(),
                    'system': stage.system,
                    'participant_mode': stage.participant_mode,
                    'groups_count': stage.groups_count,
                    'status': stage.status,
                    'participants_count': stage.entries.count(),
                    'matches_count': stage.matches.count(),
                    'is_current': stage.id == tournament_id,
                    'can_delete': stage.can_delete_stage(),
                    'can_edit': stage.can_edit_stage_settings(),
                }
                for stage in stages
            ],
            'current_stage_id': tournament_id,
            'can_add_stage': True,  # –í—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–¥–∏—é
        }
    
    @staticmethod
    @transaction.atomic
    def delete_stage(stage_id: int):
        """
        –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞–¥–∏—é —Ç—É—Ä–Ω–∏—Ä–∞
        
        Raises:
            ValueError: –ï—Å–ª–∏ —Å—Ç–∞–¥–∏—é –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å
        """
        stage = Tournament.objects.get(id=stage_id)
        
        if not stage.can_delete_stage():
            raise ValueError(
                "–ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç–∞–¥–∏—é –≤ —Å—Ç–∞—Ç—É—Å–µ CREATED"
            )
        
        stage.delete()
    
    @staticmethod
    @transaction.atomic
    def update_stage_settings(
        stage_id: int,
        system: str = None,
        groups_count: int = None,
        participant_mode: str = None
    ):
        """
        –û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∞–¥–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è CREATED)
        
        Raises:
            ValueError: –ï—Å–ª–∏ —Å—Ç–∞–¥–∏—é –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        """
        stage = Tournament.objects.get(id=stage_id)
        
        if not stage.can_edit_stage_settings():
            raise ValueError("–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞–¥–∏—é –≤ —Å—Ç–∞—Ç—É—Å–µ CREATED")
        
        if system:
            # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
            stage.get_master_tournament().validate_stage_system(system)
            stage.system = system
            
            # –î–ª—è –æ–ª–∏–º–ø–∏–π–∫–∏ –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞
            if system == 'knockout':
                stage.groups_count = 1
        
        if groups_count is not None and stage.system != 'knockout':
            stage.groups_count = groups_count
        
        if participant_mode:
            stage.participant_mode = participant_mode
        
        stage.save()
    
    @staticmethod
    @transaction.atomic
    def complete_master_tournament(master_tournament_id: int, force: bool = False):
        """
        –ó–∞–≤–µ—Ä—à–∞–µ—Ç –≤–µ—Å—å –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π
        
        Args:
            master_tournament_id: ID –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–∞
            force: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏)
        
        Raises:
            ValueError: –ï—Å–ª–∏ –Ω–µ –≤—Å–µ —Å—Ç–∞–¥–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
        """
        master = Tournament.objects.get(id=master_tournament_id)
        if not master.is_master():
            master = master.get_master_tournament()
        
        all_stages = master.get_all_stages()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–∞–¥–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
        if not force:
            incomplete_stages = [
                s for s in all_stages 
                if s.status != Tournament.Status.COMPLETED
            ]
            
            if incomplete_stages:
                raise ValueError(
                    f"–ù–µ –≤—Å–µ —Å—Ç–∞–¥–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã: {len(incomplete_stages)} —Å—Ç–∞–¥–∏–π"
                )
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –≤—Å–µ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
        from apps.players.services.rating_service import compute_ratings_for_multi_stage_tournament
        
        stage_ids = [s.id for s in all_stages]
        compute_ratings_for_multi_stage_tournament(master.id, stage_ids)
        
        # –ü–æ–º–µ—á–∞–µ–º –≤—Å–µ —Å—Ç–∞–¥–∏–∏ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
        for stage in all_stages:
            if stage.status != Tournament.Status.COMPLETED:
                stage.status = Tournament.Status.COMPLETED
                stage.save(update_fields=['status'])
```

---

## üåê –≠–¢–ê–ü 3: Backend - API Endpoints

### 3.1. –ù–æ–≤—ã–µ endpoints –≤ TournamentViewSet

```python
# apps/tournaments/api_views.py

from apps.tournaments.services.multi_stage_service import MultiStageService

class TournamentViewSet(viewsets.ModelViewSet):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã ...
    
    @action(detail=True, methods=['get'])
    def master_data(self, request, pk=None):
        """
        GET /tournaments/{id}/master_data/
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–∞ —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞–¥–∏—è–º–∏
        """
        try:
            data = MultiStageService.get_master_tournament_data(pk)
            return Response(data)
        except Tournament.DoesNotExist:
            return Response({'error': '–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω'}, status=404)
    
    @action(detail=True, methods=['post'])
    def create_stage(self, request, pk=None):
        """
        POST /tournaments/{id}/create_stage/
        –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Å—Ç–∞–¥–∏—é —Ç—É—Ä–Ω–∏—Ä–∞
        
        Body:
        {
            "stage_name": "–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è",
            "system": "knockout",
            "participant_mode": "pair",
            "groups_count": 1,
            "copy_participants": true,
            "selected_participant_ids": [1, 2, 3]  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
        }
        """
        try:
            stage_name = request.data.get('stage_name')
            system = request.data.get('system')
            participant_mode = request.data.get('participant_mode')
            groups_count = request.data.get('groups_count', 1)
            copy_participants = request.data.get('copy_participants', True)
            selected_participant_ids = request.data.get('selected_participant_ids')
            
            if not stage_name or not system or not participant_mode:
                return Response({
                    'ok': False,
                    'error': '–ù–µ —É–∫–∞–∑–∞–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è'
                }, status=400)
            
            new_stage = MultiStageService.create_next_stage(
                parent_tournament_id=pk,
                stage_name=stage_name,
                system=system,
                participant_mode=participant_mode,
                groups_count=groups_count,
                copy_participants=copy_participants,
                selected_participant_ids=selected_participant_ids,
                created_by_user=request.user
            )
            
            return Response({
                'ok': True,
                'stage_id': new_stage.id,
                'message': f'–°—Ç–∞–¥–∏—è "{stage_name}" —Å–æ–∑–¥–∞–Ω–∞'
            })
            
        except ValueError as e:
            return Response({'ok': False, 'error': str(e)}, status=400)
        except Exception as e:
            return Response({'ok': False, 'error': str(e)}, status=500)
    
    @action(detail=True, methods=['delete'])
    def delete_stage(self, request, pk=None):
        """
        DELETE /tournaments/{id}/delete_stage/
        –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞–¥–∏—é —Ç—É—Ä–Ω–∏—Ä–∞ (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤ —Å—Ç–∞—Ç—É—Å–µ CREATED)
        """
        try:
            MultiStageService.delete_stage(pk)
            return Response({'ok': True, 'message': '–°—Ç–∞–¥–∏—è —É–¥–∞–ª–µ–Ω–∞'})
        except ValueError as e:
            return Response({'ok': False, 'error': str(e)}, status=400)
        except Exception as e:
            return Response({'ok': False, 'error': str(e)}, status=500)
    
    @action(detail=True, methods=['patch'])
    def update_stage_settings(self, request, pk=None):
        """
        PATCH /tournaments/{id}/update_stage_settings/
        –û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∞–¥–∏–∏ (—Ç–æ–ª—å–∫–æ CREATED)
        
        Body:
        {
            "system": "knockout",
            "groups_count": 2,
            "participant_mode": "pair"
        }
        """
        try:
            system = request.data.get('system')
            groups_count = request.data.get('groups_count')
            participant_mode = request.data.get('participant_mode')
            
            MultiStageService.update_stage_settings(
                stage_id=pk,
                system=system,
                groups_count=groups_count,
                participant_mode=participant_mode
            )
            
            return Response({'ok': True, 'message': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã'})
        except ValueError as e:
            return Response({'ok': False, 'error': str(e)}, status=400)
        except Exception as e:
            return Response({'ok': False, 'error': str(e)}, status=500)
    
    @action(detail=True, methods=['post'])
    def complete_master(self, request, pk=None):
        """
        POST /tournaments/{id}/complete_master/
        –ó–∞–≤–µ—Ä—à–∞–µ—Ç –≤–µ—Å—å –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥
        """
        try:
            force = request.data.get('force', False)
            
            MultiStageService.complete_master_tournament(pk, force=force)
            
            return Response({
                'ok': True,
                'message': '–¢—É—Ä–Ω–∏—Ä –∑–∞–≤–µ—Ä—à–µ–Ω, —Ä–µ–π—Ç–∏–Ω–≥ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π'
            })
        except ValueError as e:
            return Response({'ok': False, 'error': str(e)}, status=400)
        except Exception as e:
            return Response({'ok': False, 'error': str(e)}, status=500)
```

### 3.2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

```python
# apps/tournaments/serializers.py

class TournamentSerializer(serializers.ModelSerializer):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    
    stages_count = serializers.SerializerMethodField()
    is_master = serializers.SerializerMethodField()
    master_tournament_id = serializers.SerializerMethodField()
    
    def get_stages_count(self, obj):
        """–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–¥–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–æ–≤)"""
        if obj.parent_tournament_id is None:
            return 1 + obj.child_stages.count()
        return None
    
    def get_is_master(self, obj):
        """–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–æ–º"""
        return obj.is_master()
    
    def get_master_tournament_id(self, obj):
        """ID –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–∞"""
        return obj.get_master_tournament().id
    
    class Meta:
        model = Tournament
        fields = [
            # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
            'parent_tournament',
            'stage_name',
            'stage_order',
            'stages_count',
            'is_master',
            'master_tournament_id',
        ]
```

### 3.3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤

```python
# apps/tournaments/api_views.py

class TournamentViewSet(viewsets.ModelViewSet):
    
    def get_queryset(self):
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä—ã –≤ —Å–ø–∏—Å–∫–µ"""
        queryset = Tournament.objects.all()
        
        # –í —Å–ø–∏—Å–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä—ã
        if self.action == 'list':
            queryset = queryset.filter(parent_tournament_id__isnull=True)
        
        return queryset.select_related('created_by').prefetch_related('entries')
```

---

## üé® –≠–¢–ê–ü 4: Frontend - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 4.1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–∞–¥–∏–π

```typescript
// frontend/src/constants/stageNames.ts

export const STAGE_NAME_PRESETS = [
  '–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è',
  '–ü–ª–µ–π-–æ—Ñ—Ñ',
  '–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è',
  '–§–∏–Ω–∞–ª –ê',
  '–§–∏–Ω–∞–ª B',
  '–§–∏–Ω–∞–ª C',
  '–§–∏–Ω–∞–ª Hard',
  '–§–∏–Ω–∞–ª Light',
  '–ü–æ–ª—É—Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è',
  '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä',
  '–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'
] as const;
```

### 4.2. –°–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–∞–¥–∏–π (–∫–∞–∫ –∫–Ω–æ–ø–∫–∏ M, MX, MU –≤ BTR)

```typescript
// frontend/src/components/TournamentStageSelector.tsx

interface Stage {
  id: number;
  stage_name: string;
  stage_order: number;
  system: string;
  status: string;
  can_delete: boolean;
  can_edit: boolean;
  is_current: boolean;
}

interface Props {
  stages: Stage[];
  currentStageId: number;
  canEdit: boolean;
  onStageChange: (stageId: number) => void;
  onDeleteStage?: (stageId: number) => void;
}

export const TournamentStageSelector: React.FC<Props> = ({
  stages,
  currentStageId,
  canEdit,
  onStageChange,
  onDeleteStage
}) => {
  // –§–∏–ª—å—Ç—Ä—É–µ–º —Å—Ç–∞–¥–∏–∏: –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –≤—Å–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Ç–æ–ª—å–∫–æ active/completed
  const visibleStages = stages.filter(stage => {
    if (canEdit) return true;
    return stage.status === 'active' || stage.status === 'completed';
  });
  
  if (visibleStages.length <= 1) return null;
  
  return (
    <div className="flex gap-1 mb-3 stage-selector">
      {visibleStages.map((stage) => (
        <div key={stage.id} className="relative">
          <button
            onClick={() => onStageChange(stage.id)}
            className={`
              px-3 py-1.5 text-sm rounded border transition-all
              ${stage.is_current
                ? 'bg-blue-600 text-white border-blue-600 font-medium'
                : 'bg-white text-gray-700 border-gray-300 hover:border-blue-400'
              }
            `}
          >
            {stage.stage_name}
          </button>
          
          {/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞–¥–∏–∏ –≤ CREATED) */}
          {canEdit && stage.can_delete && onDeleteStage && (
            <button
              onClick={(e) => {
                e.stopPropagation();
                if (confirm(`–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞–¥–∏—é "${stage.stage_name}"?`)) {
                  onDeleteStage(stage.id);
                }
              }}
              className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hover:bg-red-600"
              title="–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞–¥–∏—é"
            >
              √ó
            </button>
          )}
        </div>
      ))}
    </div>
  );
};
```

### 4.3. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞–¥–∏–∏

```typescript
// frontend/src/components/CreateStageModal.tsx

import { STAGE_NAME_PRESETS } from '../constants/stageNames';

interface Props {
  isOpen: boolean;
  onClose: () => void;
  tournamentId: number;
  masterSystem: string;  // –°–∏—Å—Ç–µ–º–∞ –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  currentParticipants: Array<{id: number; name: string}>;
  onStageCreated: (stageId: number) => void;
}

export const CreateStageModal: React.FC<Props> = ({
  isOpen,
  onClose,
  tournamentId,
  masterSystem,
  currentParticipants,
  onStageCreated
}) => {
  const [stageNamePreset, setStageNamePreset] = useState(STAGE_NAME_PRESETS[0]);
  const [customStageName, setCustomStageName] = useState('');
  const [system, setSystem] = useState<'round_robin' | 'knockout' | 'king'>(
    masterSystem === 'king' ? 'king' : 'knockout'
  );
  const [participantMode, setParticipantMode] = useState<'single' | 'pair'>('pair');
  const [groupsCount, setGroupsCount] = useState(1);
  const [copyAll, setCopyAll] = useState(true);
  const [selectedParticipants, setSelectedParticipants] = useState<number[]>([]);
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Ç—É—Ä–Ω–∏—Ä–∞
  const availableSystems = masterSystem === 'king' 
    ? [{ value: 'king', label: '–ö–∏–Ω–≥' }]
    : [
        { value: 'round_robin', label: '–ö—Ä—É–≥–æ–≤–∞—è' },
        { value: 'knockout', label: '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è' }
      ];
  
  const handleSubmit = async () => {
    const stageName = stageNamePreset === '–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ' 
      ? customStageName 
      : stageNamePreset;
    
    if (!stageName.trim()) {
      alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏');
      return;
    }
    
    try {
      const response = await api.post(`/tournaments/${tournamentId}/create_stage/`, {
        stage_name: stageName,
        system,
        participant_mode: participantMode,
        groups_count: system === 'knockout' ? 1 : groupsCount,
        copy_participants: copyAll,
        selected_participant_ids: copyAll ? null : selectedParticipants
      });
      
      if (response.data.ok) {
        alert(`–°—Ç–∞–¥–∏—è "${stageName}" —Å–æ–∑–¥–∞–Ω–∞!`);
        onStageCreated(response.data.stage_id);
        onClose();
      }
    } catch (error: any) {
      alert(error.response?.data?.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞–¥–∏–∏');
    }
  };
  
  if (!isOpen) return null;
  
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <h2 className="text-xl font-bold mb-4">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞–¥–∏—é</h2>
        
        {/* –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ */}
        <div className="mb-4">
          <label className="block mb-2 font-medium">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏</label>
          <select
            value={stageNamePreset}
            onChange={(e) => setStageNamePreset(e.target.value)}
            className="w-full border rounded px-3 py-2 mb-2"
          >
            {STAGE_NAME_PRESETS.map(name => (
              <option key={name} value={name}>{name}</option>
            ))}
          </select>
          
          {stageNamePreset === '–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ' && (
            <input
              type="text"
              value={customStageName}
              onChange={(e) => setCustomStageName(e.target.value)}
              placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏"
              className="w-full border rounded px-3 py-2"
            />
          )}
        </div>
        
        {/* –°–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–Ω–∏—Ä–∞ */}
        <div className="mb-4">
          <label className="block mb-2 font-medium">–°–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–Ω–∏—Ä–∞</label>
          <select
            value={system}
            onChange={(e) => setSystem(e.target.value as any)}
            className="w-full border rounded px-3 py-2"
          >
            {availableSystems.map(s => (
              <option key={s.value} value={s.value}>{s.label}</option>
            ))}
          </select>
          
          {masterSystem === 'king' && (
            <p className="text-sm text-gray-600 mt-1">
              ‚ÑπÔ∏è –¢—É—Ä–Ω–∏—Ä —Å–∏—Å—Ç–µ–º—ã KING –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞–¥–∏–∏ —Å–∏—Å—Ç–µ–º—ã KING
            </p>
          )}
        </div>
        
        {/* –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π) */}
        {system === 'round_robin' && (
          <div className="mb-4">
            <label className="block mb-2 font-medium">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø</label>
            <input
              type="number"
              min="1"
              max="10"
              value={groupsCount}
              onChange={(e) => setGroupsCount(parseInt(e.target.value) || 1)}
              className="w-full border rounded px-3 py-2"
            />
          </div>
        )}
        
        {/* –†–µ–∂–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */}
        <div className="mb-4">
          <label className="block mb-2 font-medium">–§–æ—Ä–º–∞—Ç</label>
          <select
            value={participantMode}
            onChange={(e) => setParticipantMode(e.target.value as any)}
            className="w-full border rounded px-3 py-2"
          >
            <option value="pair">–ü–∞—Ä–Ω—ã–π</option>
            <option value="single">–û–¥–∏–Ω–æ—á–Ω—ã–π</option>
          </select>
        </div>
        
        {/* –£—á–∞—Å—Ç–Ω–∏–∫–∏ */}
        <div className="mb-4">
          <label className="flex items-center gap-2 mb-2">
            <input
              type="checkbox"
              checked={copyAll}
              onChange={(e) => setCopyAll(e.target.checked)}
            />
            <span className="font-medium">
              –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–¥–∏–∏
            </span>
          </label>
          
          {!copyAll && (
            <div className="mt-2 border rounded p-3 max-h-60 overflow-y-auto">
              <div className="text-sm text-gray-600 mb-2">
                –í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏:
              </div>
              {currentParticipants.map(p => (
                <label key={p.id} className="flex items-center gap-2 py-1">
                  <input
                    type="checkbox"
                    checked={selectedParticipants.includes(p.id)}
                    onChange={(e) => {
                      if (e.target.checked) {
                        setSelectedParticipants([...selectedParticipants, p.id]);
                      } else {
                        setSelectedParticipants(selectedParticipants.filter(id => id !== p.id));
                      }
                    }}
                  />
                  <span>{p.name}</span>
                </label>
              ))}
            </div>
          )}
        </div>
        
        {/* –ö–Ω–æ–ø–∫–∏ */}
        <div className="flex gap-2">
          <button
            onClick={handleSubmit}
            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
          >
            –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–¥–∏—é
          </button>
          <button
            onClick={onClose}
            className="px-4 py-2 border rounded hover:bg-gray-50"
          >
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </div>
  );
};
```

### 4.4. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç–∞–¥–∏–π –≤ –ø–ª–∏—Ç–∫–µ —Ç—É—Ä–Ω–∏—Ä–∞

```typescript
// frontend/src/components/TournamentCard.tsx

{tournament.stages_count && tournament.stages_count > 1 && (
  <span className="text-xs px-2 py-0.5 rounded bg-purple-100 text-purple-700">
    {tournament.stages_count} {tournament.stages_count === 2 ? '—Å—Ç–∞–¥–∏–∏' : '—Å—Ç–∞–¥–∏–π'}
  </span>
)}
```

---

## üì± –≠–¢–ê–ü 5: Frontend - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 5.1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TournamentDetailPage

```typescript
// frontend/src/pages/TournamentDetailPage.tsx

const TournamentDetailPage = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useAuth();
  
  const [tournament, setTournament] = useState<any>(null);
  const [masterData, setMasterData] = useState<any>(null);
  const [showCreateStageModal, setShowCreateStageModal] = useState(false);
  
  const canEdit = /* –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ */;
  
  useEffect(() => {
    loadTournament();
    loadMasterData();
  }, [id]);
  
  const loadMasterData = async () => {
    try {
      const { data } = await api.get(`/tournaments/${id}/master_data/`);
      setMasterData(data);
    } catch (error) {
      console.error('Error loading master data:', error);
    }
  };
  
  const handleStageChange = (stageId: number) => {
    const stage = masterData.stages.find(s => s.id === stageId);
    if (!stage) return;
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    if (stage.system === 'knockout') {
      navigate(`/tournaments/${stageId}/knockout`);
    } else if (stage.system === 'king') {
      navigate(`/tournaments/${stageId}/king`);
    } else {
      navigate(`/tournaments/${stageId}`);
    }
  };
  
  const handleDeleteStage = async (stageId: number) => {
    try {
      await api.delete(`/tournaments/${stageId}/delete_stage/`);
      alert('–°—Ç–∞–¥–∏—è —É–¥–∞–ª–µ–Ω–∞');
      loadMasterData();
      
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç–∞–¥–∏—é
      const stages = masterData.stages.filter(s => s.id !== stageId);
      if (stages.length > 0) {
        handleStageChange(stages[stages.length - 1].id);
      }
    } catch (error: any) {
      alert(error.response?.data?.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç–∞–¥–∏–∏');
    }
  };
  
  return (
    <div className="container mx-auto p-4">
      {/* –°–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–∞–¥–∏–π */}
      {masterData && (
        <TournamentStageSelector
          stages={masterData.stages}
          currentStageId={parseInt(id)}
          canEdit={canEdit}
          onStageChange={handleStageChange}
          onDeleteStage={canEdit ? handleDeleteStage : undefined}
        />
      )}
      
      {/* –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞ */}
      <h1 className="text-2xl font-bold mb-2">{tournament?.name}</h1>
      
      {/* –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}
      {/* ... */}
      
      {/* –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–¥–∏—é" (–≤–Ω–∏–∑—É, –ø–µ—Ä–µ–¥ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è") */}
      {canEdit && (
        <button
          onClick={() => setShowCreateStageModal(true)}
          className="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 mb-2"
        >
          + –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–¥–∏—é
        </button>
      )}
      
      {/* –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" */}
      <button className="w-full px-4 py-2 border rounded hover:bg-gray-50">
        üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
      </button>
      
      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞–¥–∏–∏ */}
      {showCreateStageModal && masterData && (
        <CreateStageModal
          isOpen={showCreateStageModal}
          onClose={() => setShowCreateStageModal(false)}
          tournamentId={parseInt(id)}
          masterSystem={masterData.master.system}
          currentParticipants={participants}
          onStageCreated={(stageId) => {
            loadMasterData();
            handleStageChange(stageId);
          }}
        />
      )}
    </div>
  );
};
```

### 5.2. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è KnockoutPage –∏ KingPage

–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç—É –∂–µ –ª–æ–≥–∏–∫—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å—Ç–∞–¥–∏–π –∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞.

### 5.3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"

```typescript
const handleShare = async () => {
  // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–∞–¥–∏–π
  const stageSelector = document.querySelector('.stage-selector');
  const originalDisplay = stageSelector?.style.display;
  
  if (stageSelector) {
    stageSelector.style.display = 'none';
  }
  
  try {
    // –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç
    const element = document.getElementById('tournament-content');
    if (element) {
      const canvas = await html2canvas(element);
      // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
    }
  } finally {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
    if (stageSelector && originalDisplay) {
      stageSelector.style.display = originalDisplay;
    }
  }
};
```

---

## üßÆ –≠–¢–ê–ü 6: –†–∞—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤

### 6.1. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è rating_service

```python
# apps/players/services/rating_service.py

def compute_ratings_for_multi_stage_tournament(master_tournament_id: int, stage_ids: list[int]):
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞.
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –º–∞—Ç—á–∏ –∏–∑ –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ.
    
    Args:
        master_tournament_id: ID –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–∞
        stage_ids: –°–ø–∏—Å–æ–∫ ID –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π (–≤–∫–ª—é—á–∞—è –º–∞—Å—Ç–µ—Ä)
    """
    from apps.matches.models import Match
    from apps.players.models import Player, PlayerRatingDynamic, PlayerRatingHistory
    from apps.tournaments.models import Tournament, TournamentEntry
    from django.db.models import Q
    
    master = Tournament.objects.get(id=master_tournament_id)
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏ –∏–∑ –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π
    all_matches = Match.objects.filter(
        tournament_id__in=stage_ids,
        status=Match.Status.COMPLETED
    ).exclude(
        Q(team_1__isnull=True) | Q(team_2__isnull=True)  # –ò—Å–∫–ª—é—á–∞–µ–º BYE
    ).select_related(
        'team_1', 'team_2', 'tournament'
    ).prefetch_related(
        'team_1__player_1', 'team_1__player_2',
        'team_2__player_1', 'team_2__player_2'
    ).order_by('finished_at', 'id')
    
    # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    all_player_ids = set()
    for match in all_matches:
        if match.team_1:
            if match.team_1.player_1_id:
                all_player_ids.add(match.team_1.player_1_id)
            if match.team_1.player_2_id:
                all_player_ids.add(match.team_1.player_2_id)
        if match.team_2:
            if match.team_2.player_1_id:
                all_player_ids.add(match.team_2.player_1_id)
            if match.team_2.player_2_id:
                all_player_ids.add(match.team_2.player_2_id)
    
    # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å–∏ PlayerRatingDynamic –¥–ª—è –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä–∞
    for player_id in all_player_ids:
        player = Player.objects.get(id=player_id)
        PlayerRatingDynamic.objects.create(
            player=player,
            tournament_id=master_tournament_id,  # –í–∞–∂–Ω–æ: –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä!
            rating_before=player.current_rating,
            rating_after=player.current_rating
        )
    
    # –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å is_out_of_competition –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π
    entry_map = {}
    for stage_id in stage_ids:
        entries = TournamentEntry.objects.filter(tournament_id=stage_id)
        for entry in entries:
            entry_map[(stage_id, entry.team_id)] = entry
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Ç—á–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
    for match in all_matches:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º is_out_of_competition
        team1_entry = entry_map.get((match.tournament_id, match.team_1_id))
        team2_entry = entry_map.get((match.tournament_id, match.team_2_id))
        
        if (team1_entry and team1_entry.is_out_of_competition) or \
           (team2_entry and team2_entry.is_out_of_competition):
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–∞—Ç—á, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –Ω—É–ª–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            # ... –ª–æ–≥–∏–∫–∞ –∑–∞–ø–∏—Å–∏ –Ω—É–ª–µ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
            continue
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É)
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞
        
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ PlayerRatingHistory —Å tournament_id = match.tournament_id
        # –û–±–Ω–æ–≤–ª—è–µ–º PlayerRatingDynamic —Å tournament_id = master_tournament_id
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### Backend:
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–∏—Ç—å `stage_name` –∏ `stage_order`
- [ ] –ú–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–∏ Tournament (get_master_tournament, get_all_stages, etc.)
- [ ] –°–µ—Ä–≤–∏—Å MultiStageService
- [ ] API endpoints (master_data, create_stage, delete_stage, update_stage_settings, complete_master)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä-—Ç—É—Ä–Ω–∏—Ä—ã)
- [ ] –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è rating_service –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤

### Frontend:
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã STAGE_NAME_PRESETS
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç TournamentStageSelector
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç CreateStageModal
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–¥–∏–π –≤ TournamentCard
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ TournamentDetailPage
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ KnockoutPage
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ KingPage
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç–∞–¥–∏—è–º–∏
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞–¥–∏–∏
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã KING (–Ω–µ –º–æ–∂–µ—Ç —Å–º–µ—à–∏–≤–∞—Ç—å—Å—è —Å RR/Knockout)
- [ ] –†–∞—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∞–¥–∏–π –ø–æ —Ä–æ–ª–∏ (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä vs –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –±–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å—Ç–∞–¥–∏–π
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç–∞–¥–∏–∏ (—Ç–æ–ª—å–∫–æ CREATED)
- [ ] –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞–¥–∏–∏
- [ ] –í—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞–¥–∏–∏

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤
–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
1. –ù–∞–π—Ç–∏ —Ç—É—Ä–Ω–∏—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å (–ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –¥–∞—Ç–µ, —É—á–∞—Å—Ç–Ω–∏–∫–∞–º)
2. –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ `parent_tournament_id`
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `stage_name` –∏ `stage_order`
4. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å—Ç–∞–¥–∏—é" (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ–∑–∂–µ)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞–¥–∏—è–º–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Å—Ç–∞–¥–∏—è–º —Ç—É—Ä–Ω–∏—Ä–∞
- –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π –æ–¥–Ω–∏–º —Ñ–∞–π–ª–æ–º

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–∞:** 26 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
