# Статус проекта SandMatch (2025-09-26)

## Кратко
Построен рабочий MVP0 на Django + PostgreSQL в Docker. Реализованы базовые сущности и UI для круговой части турнира, ввод счёта, восстановление данных и автоматический пересчёт технических столбцов. Добавлен экспорт PNG по кнопке «Поделиться» с бренд‑шапкой/футером.

## Что сделано
- Бэкенд и инфраструктура
  - Django-проект со структурой приложений: `players`, `teams`, `tournaments`, `matches`.
  - Docker + docker-compose, локальный запуск на http://localhost:8080.
  - Миграции Django для всех моделей, удалены устаревшие sql-файлы.
  - Пресеты: management-команды `seed_rulesets`, `reset_presets`.
  - Генерация кругового расписания: `generate_round_robin` (админка + команда).
- Модели и данные
  - `Player`, `Team` (одиночка/пара с ограничениями), `Tournament`, `TournamentEntry`, `TournamentEntryStats`.
  - `Match`, `MatchSet`, `MatchSpecialOutcome` (структура заложена, UI пока без особых исходов).
- UI и логика турниров
  - Страница списка турниров: активные и история.
  - Страница турнира (круговая матрица):
    - добавление участников в таблицу;
    - ввод счёта (MVP: один сет) с подтверждением;
    - зеркальное отображение счёта во второй ячейке (например, 6:4 → 4:6);
    - восстановление счёта и live-статуса из БД при загрузке страницы;
    - автопересчёт и отрисовка тех. столбцов: победы, сеты, соотношения, геймы; расчёт «Места» по каскаду: Победы → личная встреча → Сеты соот. → личная встреча → Геймы соот. → личная встреча → дополнительные критерии (по рейтингу, затем по алфавиту);
    - экспорт PNG «Поделиться»: учитывает видимые столбцы и ФИО; в картинку не попадают служебные элементы (переключатели, чекбокс фиксации, туры, нижняя панель);
    - действия «Начать матч», «Отменить начало» (live → обычная).

## Что работает сейчас
- Создание турнира с параметрами (`SetFormat`, `Ruleset`, группы, план).
- Генерация пар круговой системы (админ-действие/команда).
- Ввод и сохранение счёта одного сета, фиксация победителя и завершение матча (счёт сетов хранится «от победителя»).
- Восстановление счёта/статуса при перезагрузке, зеркальное отображение.
- Автоматический пересчёт агрегатов группы и заполнение тех. столбцов в UI; ранжирование мест согласно регламенту.

## Что предстоит сделать (ближайшие задачи)
- Ввод нескольких сетов и тай-брейков с валидацией по `SetFormat`.
- Сортировка и критерии мест по `Ruleset` (включая h2h) и отображение в UI.
- Кнопка «Сгенерировать расписание» прямо на странице турнира (без админки).
- Экспорт/«Поделиться»: печатная версия, публичный URL и `favicon`.
- Улучшение UX модалок (клавиатура, фокус, Escape, ошибки API).

## Запуск и эксплуатация (локально)
- Сборка и запуск:
  ```bash
  docker compose up --build -d
  docker compose logs -f web
  ```
- Миграции и сервисные команды:
  ```bash
  docker compose exec web python manage.py migrate
  docker compose exec web python manage.py seed_rulesets
  docker compose exec web python manage.py generate_round_robin <tournament_id>
  ```
- Админка: http://localhost:8080/sm-admin

## Известные ограничения MVP0
- Только один сет в UI ввода счёта (без тай-брейков).
- Плей-офф UI не реализован.
- Публичного шаринга ещё нет (только локальная выгрузка PNG).
- Чемпионский тай‑брейк временно учитывается как значения TB; TODO: в «Сеты» учитывать как 1:0/0:1.

## Ссылки на файлы
- Основной роутинг: `sandmatch/urls.py`
- Логика турниров: `apps/tournaments/views.py`, сервисы: `apps/tournaments/services/`
- Шаблон страницы турнира: `templates/tournaments/detail.html`
- Документация: `README.md`, `docs/DB.md`, `docs/PLAN.md`
